<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>You're Invited – ManageMate</title>
    <style>
      * { box-sizing: border-box; margin: 0; padding: 0; }
      body {
        background: #f5f5f5;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
                     Helvetica, Arial, sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 24px;
      }
      .card {
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 4px 24px rgba(0,0,0,0.10);
        max-width: 420px;
        width: 100%;
        padding: 40px 32px;
        text-align: center;
      }
      .icon {
        width: 72px;
        height: 72px;
        background: #000;
        border-radius: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 24px;
      }
      .icon svg { fill: #fff; width: 40px; height: 40px; }
      h1 { font-size: 22px; font-weight: 700; color: #111; margin-bottom: 10px; }
      p  { font-size: 15px; color: #555; line-height: 1.6; margin-bottom: 32px; }
      .btn {
        display: inline-block;
        background: #000;
        color: #fff;
        text-decoration: none;
        padding: 16px 40px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        width: 100%;
        cursor: pointer;
        border: none;
      }
      .btn:hover { background: #222; }
      .fallback {
        margin-top: 20px;
        font-size: 13px;
        color: #888;
      }
      .fallback a { color: #333; font-weight: 500; }
      #status { margin-top: 16px; font-size: 13px; color: #777; min-height: 18px; }
    </style>
  </head>
  <body>
    <div class="card">
      <div class="icon">
        <!-- calendar/schedule icon -->
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M19 4h-1V2h-2v2H8V2H6v2H5C3.89 2 3 2.9 3 4v16c0 1.1.89
                   2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 18H5V9h14v13zM7
                   11h5v5H7z"/>
        </svg>
      </div>

      <h1>You've been invited!</h1>
      <p>
        You've been invited to join the<br>
        <strong>Scheduling &amp; Stakeholder Management</strong> app.<br>
        Tap the button below to create your account.
      </p>

      <button type="button" class="btn" id="openBtn" onclick="openApp()">
        Open SSMS &amp; Sign Up
      </button>

      <div id="status"></div>

      <div class="fallback" id="fallback">
        Don't have the app?
        <a href="https://play.google.com/store/apps/details?id=com.managemateapp.ssms" id="storeLink">Download it here</a>
      </div>
    </div>

    <script>
      const ua = navigator.userAgent || '';
      const isIOS = /iPad|iPhone|iPod/.test(ua);
      const isAndroid = /Android/.test(ua);
      const isMobile = isIOS || isAndroid;

      // On desktop, hide the button and show a clear message instead
      if (!isMobile) {
        document.getElementById('openBtn').style.display = 'none';
        document.getElementById('fallback').style.display = 'none';
        document.getElementById('status').textContent =
          'This invite link is for the SSMS mobile app. Open it on your Android or iOS device to sign up.';
      }

      if (isIOS) {
        document.getElementById('storeLink').href =
          'https://apps.apple.com/app/managemate/id0000000000'; // update when live
        document.getElementById('storeLink').textContent = 'Download on the App Store';
      }

      function getToken() {
        return new URLSearchParams(window.location.search).get('token') || '';
      }

      function openApp() {
        const token = getToken();
        if (!token) {
          document.getElementById('status').textContent =
            'Invalid invite link — the token is missing.';
          return;
        }

        // Custom scheme: caught immediately if the app is installed
        const schemeLink = 'managemateapp://invite?token=' + encodeURIComponent(token);
        // HTTPS App Link: Android will intercept this if App Links are verified
        const universalLink = 'https://managemateapp.me/invite?token=' + encodeURIComponent(token);

        if (isIOS) {
          // iOS: use universal link (Apple Universal Links)
          window.location.href = universalLink;
        } else if (isAndroid) {
          // Android: try custom scheme first; if the app is installed it opens immediately
          window.location.href = schemeLink;
        }

        // Show fallback message after 2.5s if the app didn't open
        setTimeout(function() {
          document.getElementById('status').textContent =
            'App not opening? Make sure the SSMS app is installed, then tap the button again.';
        }, 2500);
      }

      // Auto-trigger on load for mobile (best UX — no extra tap needed)
      window.addEventListener('load', function() {
        const token = getToken();
        if (token && isMobile) {
          setTimeout(openApp, 600);
        }
      });
    </script>
  </body>
</html>
